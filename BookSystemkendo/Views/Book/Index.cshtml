
@{
    ViewBag.Title = "Index";
}

<h2 style="font-family:Microsoft JhengHei;">圖書維護</h2>

<div class="form-horizontal">

    <div class="form-group" style="margin-bottom:20px;margin-top:20px">
        <label class="col-md-2 control-label">書名</label>
        <div class="col-md-10">
            <input id="book_name" class="form-control" />
        </div>
    </div>

    <div class="form-group" style="margin-bottom:20px">
        <label class="col-md-2 control-label">圖書類別</label>
        <div class="col-md-10">
            <select id="dropdown_classname"></select>
        </div>
    </div>

    <div class="form-group" style="margin-bottom:20px">
        <label class="col-md-2 control-label">借閱人</label>
        <div class="col-md-10">
            <select id="dropdown_username"></select>
        </div>
    </div>

    <div class="form-group" style="margin-bottom:20px">
        <label class="col-md-2 control-label">借閱狀態</label>
        <div class="col-md-10">
            <select id="dropdown_codename"></select>
        </div>
    </div>

    <div class="form-group">
        <div class="col-md-2">
        </div>
        <div class="col-md-10">
            <input type="button" value="查詢" class="btn btn_search"  style="background-color: #99b2db; color:#194284" />
            <input type="button" value="新增" onclick="location.href = '/Book/InsertBook'" class="btn" style="background-color: #CCDDFF; color:#194284" />
            <input type="button" value="清除" onclick="location.href = '/Book/Index'" class="btn" style="background-color: #CCDDFF; color:#194284" />
        </div>
    </div>

    <div id="search_grid"></div>

</div>




    <script>

    //kendoDropDownList
        $(function () {
            $("#dropdown_classname").kendoDropDownList({
                dataTextField: "Text",
                dataValueField: "Value",
                optionLabel:"請選擇",
                dataSource: {
                    transport: {
                        read: {
                            url: "GetClassNameDropDownList",
                            type: "post",
                            dataType: "json"
                        }
                    }
                }
            })
            $("#dropdown_username").kendoDropDownList({
                dataTextField: "Text",
                dataValueField: "Value",
                optionLabel:"請選擇",
                dataSource: {
                    transport: {
                        read: {
                            url: "GetUserNameDropDownList",
                            type: "post",
                            dataType: "json"
                        }
                    }
                }
            })
            $("#dropdown_codename").kendoDropDownList({
                dataTextField: "Text",
                dataValueField: "Value",
                optionLabel:"請選擇",
                dataSource: {
                    transport: {
                        read: {
                            url: "GetCodeNameDropDownList",
                            type: "post",
                            dataType: "json"
                        }
                    }
                }
            })

    // kendoGrid
            $(".btn_search").click(function () {
                var search_data = {
                    "BookName": $("#book_name").val(),
                    "ClassNameID": $("#dropdown_classname").val(),
                    "UserName": $("#dropdown_username").val(),
                    "CodeID": $("#dropdown_codename").val()
                };
                $("#search_grid").kendoGrid({
            height: 500,
            columns: [
                { field: "BookClassName", title: "圖書類別", width:"60px"},
                { field: "BookName", title: "書名", width:"210px"},
                { field: "BookBoughtDate", title: "購書日期", width:"50px"},
                { field: "CodeName", title: "借閱狀態", width:"70px"},
                { field: "UserName", title: "借閱人", width: "60px" },
                { command: { text: "借閱紀錄"}, title: " ", width: "50px" },
                { command: { text: "修改" }, title: " ", width: "50px" },
                { command: { text: "刪除", click: deleteBook }, title: " ", width: "50px"}
             ],
            dataSource: {
                transport: {
                    read: {
                        url: "GetGridData",
                        type: "post",
                        dataType: "json",
                        data: search_data
                    }
                }
            }
        })
            });
        });

    // 刪除書本
function deleteBook(e) {
    var Check = confirm('確定是否刪除這筆紀錄?');
    if (Check == true) {
        e.preventDefault();
        var delete_data = this.dataItem($(e.currentTarget).closest("tr")).BookID
        $.ajax({
            type: "POST",
            url: "DeleteBook",
            data: { "BookID": delete_data },
            dataType: "json",
            success: function (response) {
                if (response == true) {
                    $(delete_data).remove();
                    alert("圖書已刪除");
                     $("#search_grid").data("kendoGrid").dataSource.read();
                }
            },
            error: function (error) {
                alert("系統發生錯誤");
            }
        });
    }
}
          
      
    </script>
